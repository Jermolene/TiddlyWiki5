title: $:/core/ui/TagTemplate

\define tag-styles() color:$(foregroundColor)$;background-color:$(backgroundColor)$;
\define svg-style() fill:$(foregroundColor)$;

\define tag-body-inner()
<$vars foregroundColor=<<contrastcolour
	target:"""$(backgroundColor)$"""
	fallbackTarget:"""$(fallbackTarget)$"""
	colourA:"""$(colourA)$"""
	colourB:"""$(colourB)$""">>>
<$reveal type="nomatch" text="$(tag-no-popup)$" default="">
<span class="tc-btn-invisible tc-tag-label" style=<<tag-styles>>>
<$transclude tiddler={{!!icon}}/><$view field="title" format="text"/>
<$reveal type="nomatch" text="$(tag-remove)$" default="">
<$button message="tm-remove-tag" param={{!!title}}
class="tc-btn-invisible tc-remove-tag-button">&times;</$button>
</$reveal>
</span>
</$reveal>
<$reveal type="match" text="$(tag-no-popup)$" default="">
<$button popup=<<qualify "$:/state/popup/tag">>
class="tc-btn-invisible tc-tag-label" style=<<tag-styles>>>
<$transclude tiddler={{!!icon}}/><$view field="title" format="text"/>
</$button>
<$reveal state=<<qualify "$:/state/popup/tag">> type="popup" position="below" animate="yes">
<div class="tc-drop-down">
<$transclude tiddler="$:/core/ui/ListItemTemplate"/>
<hr>
<$list filter="[all[current]tagging[]]" template="$:/core/ui/ListItemTemplate"/>
</div>
</$reveal>
</$reveal>
</$vars>
\end

\define tag-body(palette)
<$vars
	backgroundColor={{!!color}}
	fallbackTarget={{$palette$##tag-background}}
	colourA={{$palette$##foreground}}
	colourB={{$palette$##background}}>
<<tag-body-inner>>
</$vars>
\end

<span class="tc-tag-list-item">
<$macrocall $name="tag-body" palette={{$:/palette}}>
</span>