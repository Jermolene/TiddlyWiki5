title: $:/core/ui/EditorToolbar/file-import
tags: $:/tags/EditorTools
condition: [<targetTiddler>filter{$:/config/Editor/EnableImportFilter}]

\procedure lingo-base() $:/language/Import/

\procedure closePopupActions()
<$action-deletetiddler $filter="[title<importState>] [title<importTitle>]"/>
\end

\procedure tw5-ImageTemplate() [img[$1$]]
\procedure tw5-FileTemplate() [[$1$]]

\procedure markdown-ImageTemplate() ![]($1$)
\procedure mardkown-FileTempalte() []($1$)

\function is.Markdown.Tiddler() [all[]type[text/x-markdown]] [all[]type[text/markdown]]
\function getImageTemplate() [<storyTiddler>is.Markdown.Tiddler[]then<markdown-ImageTemplate>else<tw5-ImageTemplate>]
\function getFileTemplate() [<storyTiddler>is.Markdown.Tiddler[]then<mardkown-FileTemplate>else<tw5-FileTemplate>]
\function getReplacementTemplate() [get[type]prefix[image]then<getImageTemplate>else<getFileTemplate>]


\procedure postImportActions()
\whitespace trim
<$list filter="[<importTitle>links[]] :reduce[<getReplacementTemplate>substitute<currentTiddler>addprefix<accumulator>]" variable="imageTitle">
<$action-sendmessage
	$message="tm-edit-text-operation"
	$param="insert-text"
	text=<<imageTitle>>
/>
</$list>
<<closePopupActions>>
\end

\procedure buttons()
\whitespace trim
<$button class="tc-btn-invisible" actions=<<closePopupActions>> ><<lingo Listing/Cancel/Caption>></$button>
&#32;
<$button class="tc-btn-invisible" message="tm-perform-import" param=<<importTitle>> actions=<<postImportActions>> ><<lingo Listing/Import/Caption>></$button>
\end

\whitespace trim
<$reveal type="popup" state=<<importState>> tag="div" class="tc-editor-importpopup">
<div class="tc-editor-import">
<$list filter="[<importTitle>field:plugin-type[import]]">
<h2><<lingo Editor/Import/Heading>></h2>
<$tiddler tiddler=<<importTitle>>>
{{||$:/core/ui/ImportListing}}
<<buttons>>
</$tiddler>
</$list>
</div>
</$reveal>
