title: $:/TagManager
icon: $:/core/images/tag-button
color: #bbb
caption: {{$:/language/TagManager/Caption}}

\define lingo-base() $:/language/TagManager/
\define iconEditorTab(type)
<$list filter="[all[shadows+tiddlers]is[image]] [all[shadows+tiddlers]tag[$:/tags/Image]] -[type[application/pdf]] +[sort[title]] +[$type$is[system]]">
<$link to={{!!title}}>
<$transclude/> <$view field="title"/>
</$link>
</$list>
\end
\define iconEditor-inner(title,state)
<$button popup=<<__state__>> class="tc-btn-invisible tc-btn-dropdown" nostatereference="true">{{$:/core/images/down-arrow}}</$button>
<$reveal state=<<__state__>> type="popup" position="belowleft" text="" default="" nostatereference="true">
<div class="tc-drop-down">
<$linkcatcher actions="""<$action-setfield $tiddler={{{ [[$(encodedTitle)$]decodeuricomponent[]] }}} icon=<<navigateTo>>/>""">
<$macrocall $name="iconEditorTab" type="!"/>
<hr/>
<$macrocall $name="iconEditorTab" type=""/>
</$linkcatcher>
</div>
</$reveal>
\end
\define iconEditor(title)
<$wikify name="toggle-state" text="""<$macrocall $name="qualify" title={{{ [[$:/state/popup/icon/]addsuffix<__title__>] }}}/>""">
<div class="tc-drop-down-wrapper">
<$macrocall $name="iconEditor-inner" title=<<__title__>> state=<<toggle-state>>/>
</div>
</$wikify>
\end
\define qualifyTitle(title)
$title$$(currentTiddler)$
\end
\define toggleButton(state)
<$reveal state=<<__state__>> type="match" text="closed" default="closed" nostatereference="true">
<$button set=<<__state__>> setTo="open" class="tc-btn-invisible tc-btn-dropdown" selectedClass="tc-selected" nostatereference="true">
{{$:/core/images/info-button}}
</$button>
</$reveal>
<$reveal state=<<__state__>> type="match" text="open" default="closed" nostatereference="true">
<$button set=<<__state__>> setTo="closed" class="tc-btn-invisible tc-btn-dropdown" selectedClass="tc-selected" nostatereference="true">
{{$:/core/images/info-button}}
</$button>
</$reveal>
\end
<table class="tc-tag-manager-table">
<tbody>
<tr>
<th><<lingo Colour/Heading>></th>
<th class="tc-tag-manager-tag"><<lingo Tag/Heading>></th>
<th><<lingo Count/Heading>></th>
<th><<lingo Icon/Heading>></th>
<th><<lingo Info/Heading>></th>
</tr>
<$list filter="[tags[]!is[system]sort[title]]">
<$wikify name="toggle-state" text="""<$macrocall $name="qualify" title={{{ [[$:/state/tag-manager/]addsuffix<currentTiddler>] }}}/>""">
<tr>
<td><$edit-text field="color" tag="input" type="color"/></td>
<td><$list filter="[<currentTiddler>]" template="$:/core/ui/TagTemplate"/></td>
<td><$count filter="[all[current]tagging[]]"/></td>
<td>
<$vars encodedTitle={{{ [<currentTiddler>encodeuricomponent[]] }}}>
<$macrocall $name="iconEditor" title={{{ [<currentTiddler>] }}}/>
</$vars>
</td>
<td>
<$macrocall $name="toggleButton" state=<<toggle-state>> />
</td>
</tr>
<tr>
<td></td>
<td colspan="4">
<$reveal state=<<toggle-state>> type="match" text="open" default="" nostatereference="true">
<table>
<tbody>
<tr><td><<lingo Colour/Heading>></td><td><$edit-text field="color" tag="input" type="text" size="9"/></td></tr>
<tr><td><<lingo Icon/Heading>></td><td><$edit-text field="icon" tag="input" size="45"/></td></tr>
</tbody>
</table>
</$reveal>
</td>
</tr>
</$wikify>
</$list>
<tr>
<td></td>
<td>
{{$:/core/ui/UntaggedTemplate}}
</td>
<td>
<small class="tc-menu-list-count"><$count filter="[untagged[]!is[system]] -[tags[]]"/></small>
</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
